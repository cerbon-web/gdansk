"use strict";(self.webpackChunkfrontend_raw=self.webpackChunkfrontend_raw||[]).push([[246],{246(X,y,a){a.d(y,{DailyContestComponent:()=>V});var d=a(5841),v=a(8527),m=a(861),h=a(483),l=a(7199),g=a(1353);class b extends g.yU{constructor(n,e){super()}schedule(n,e=0){return this}}const f={setInterval(o,n,...e){const{delegate:s}=f;return s?.setInterval?s.setInterval(o,n,...e):setInterval(o,n,...e)},clearInterval(o){const{delegate:n}=f;return(n?.clearInterval||clearInterval)(o)},delegate:void 0};var C=a(3774),I=a(843);class p{constructor(n,e=p.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,s){return new this.schedulerActionCtor(this,n).schedule(s,e)}}p.now=I.U.now;const _=new class x extends p{constructor(n,e=p.now){super(n,e),this.actions=[],this._active=!1}flush(n){const{actions:e}=this;if(this._active)return void e.push(n);let s;this._active=!0;do{if(s=n.execute(n.state,n.delay))break}while(n=e.shift());if(this._active=!1,s){for(;n=e.shift();)n.unsubscribe();throw s}}}(class k extends b{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var s;if(this.closed)return this;this.state=n;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(r,this.id,e),this}requestAsyncId(n,e,s=0){return f.setInterval(n.flush.bind(n,this),s)}recycleAsyncId(n,e,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return e;null!=e&&f.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(n,e);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let i,s=!1;try{this.work(n)}catch(r){s=!0,i=r||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:n,scheduler:e}=this,{actions:s}=e;this.work=this.state=this.scheduler=null,this.pending=!1,(0,C.o)(s,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}}),A=_;var w=a(3859),S=a(9668);var t=a(6341),c=a(5753),D=a(4287),T=a(197);function E(o,n){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"h3"),t.EFF(2,"Supervisor: control"),t.k0s(),t.j41(3,"p"),t.EFF(4,"Active: "),t.j41(5,"strong"),t.EFF(6),t.k0s()(),t.j41(7,"label"),t.EFF(8,"Questions (JSON array):"),t.k0s(),t.j41(9,"textarea",5),t.mxI("ngModelChange",function(i){c.eBV(e);const r=t.XpG();return t.DH7(r.supervisorQuestionsRaw,i)||(r.supervisorQuestionsRaw=i),c.Njj(i)}),t.k0s(),t.j41(10,"div",6)(11,"button",7),t.bIt("click",function(){c.eBV(e);const i=t.XpG();return c.Njj(i.startParticipation())}),t.EFF(12,"Start participating"),t.k0s(),t.j41(13,"button",7),t.bIt("click",function(){c.eBV(e);const i=t.XpG();return c.Njj(i.stopParticipation())}),t.EFF(14,"Stop"),t.k0s()()()}if(2&o){const e=t.XpG();t.R7$(6),t.JRh(e.statusActive?"Yes":"No"),t.R7$(3),t.R50("ngModel",e.supervisorQuestionsRaw)}}function P(o,n){1&o&&(t.j41(0,"p"),t.EFF(1,"Daily contest is not active right now. Please wait for supervisor to start."),t.k0s())}function G(o,n){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"p"),t.EFF(2),t.k0s(),t.j41(3,"button",7),t.bIt("click",function(){c.eBV(e);const i=t.XpG(2);return c.Njj(i.fetchQuestions())}),t.EFF(4,"Fetch Questions & Start"),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(2),t.SpI("Daily contest is active. Click the button to fetch questions and start your countdown (",e.duration,"s).")}}function M(o,n){if(1&o){const e=t.RV6();t.j41(0,"div",11)(1,"label"),t.EFF(2),t.k0s(),t.j41(3,"div")(4,"textarea",12),t.mxI("ngModelChange",function(i){const r=c.eBV(e).index,u=t.XpG(3);return t.DH7(u.answers[r],i)||(u.answers[r]=i),c.Njj(i)}),t.k0s()()()}if(2&o){const e=n.$implicit,s=n.index,i=t.XpG(3);t.R7$(2),t.Lme("Q",s+1,": ",e.text||e.question||"Question "+(s+1)),t.R7$(2),t.Y8G("name",t.VkB("a",s)),t.R50("ngModel",i.answers[s])}}function N(o,n){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"p"),t.EFF(2,"Time left: "),t.j41(3,"strong"),t.EFF(4),t.k0s()(),t.j41(5,"form",8),t.bIt("ngSubmit",function(){c.eBV(e);const i=t.XpG(2);return c.Njj(i.submitAnswers())}),t.DNE(6,M,5,5,"div",9),t.j41(7,"div")(8,"button",10),t.bIt("click",function(){c.eBV(e);const i=t.XpG(2);return c.Njj(i.submitAnswers())}),t.EFF(9,"Submit Answers"),t.k0s()()()()}if(2&o){const e=t.XpG(2);t.R7$(4),t.SpI("",e.countdown,"s"),t.R7$(2),t.Y8G("ngForOf",e.questions),t.R7$(2),t.Y8G("disabled",e.countdown<=0)}}function B(o,n){if(1&o&&(t.j41(0,"div")(1,"h3"),t.EFF(2,"Daily Contest"),t.k0s(),t.DNE(3,P,2,0,"p",4)(4,G,5,1,"div",4)(5,N,10,3,"div",4),t.k0s()),2&o){const e=t.XpG();t.R7$(3),t.Y8G("ngIf",!e.statusActive),t.R7$(),t.Y8G("ngIf",e.statusActive&&!e.questions),t.R7$(),t.Y8G("ngIf",e.questions)}}let V=(()=>{class o{router;http;auth;isSupervisor=!1;statusActive=!1;duration=60;questions=null;sessionId;answers={};countdown=0;timerRef=null;rolesSub;pollSub;API="https://api.cerbon.id/islam.gdansk";constructor(e,s,i){this.router=e,this.http=s,this.auth=i}ngOnInit(){this.rolesSub=this.auth.roles$.subscribe(e=>{this.isSupervisor=Array.isArray(e)&&e.includes("supervisor")}),this.checkStatus(),this.pollSub=function R(o=0,n=_){return o<0&&(o=0),function j(o=0,n,e=A){let s=-1;return null!=n&&((0,S.m)(n)?e=n:s=n),new w.c(i=>{let r=function F(o){return o instanceof Date&&!isNaN(o)}(o)?+o-e.now():o;r<0&&(r=0);let u=0;return e.schedule(function(){i.closed||(i.next(u++),0<=s?this.schedule(void 0,s):i.complete())},r)})}(o,o,n)}(5e3).subscribe(()=>this.checkStatus())}ngOnDestroy(){try{this.rolesSub?.unsubscribe()}catch{}try{this.pollSub?.unsubscribe()}catch{}this.clearTimer()}onBack(){try{this.router.navigate(["/"])}catch{}}checkStatus(){var e=this;return(0,d.A)(function*(){try{const s=yield e.http.get(e.API+"/daily/status").toPromise();e.statusActive=!!s.active,e.duration=s.duration_seconds||60}catch{e.statusActive=!1}})()}supervisorQuestionsRaw='[{"text":"Question 1?"},{"text":"Question 2?"}]';startParticipation(){var e=this;return(0,d.A)(function*(){try{const s=JSON.parse(e.supervisorQuestionsRaw),i=e.auth.getToken(),r=i?new h.Lr({Authorization:"Bearer "+i}):void 0;yield e.http.post(e.API+"/daily/start",{questions:s,duration_seconds:60},{headers:r}).toPromise(),yield e.checkStatus(),alert("Started")}catch(s){alert("Failed to start: "+String(s))}})()}stopParticipation(){var e=this;return(0,d.A)(function*(){try{const s=e.auth.getToken(),i=s?new h.Lr({Authorization:"Bearer "+s}):void 0;yield e.http.post(e.API+"/daily/stop",{},{headers:i}).toPromise(),yield e.checkStatus(),alert("Stopped")}catch(s){alert("Failed to stop: "+String(s))}})()}fetchQuestions(){var e=this;return(0,d.A)(function*(){try{const s=e.auth.getToken(),i=s?new h.Lr({Authorization:"Bearer "+s}):void 0,r=yield e.http.post(e.API+"/daily/fetch",{},{headers:i}).toPromise();e.questions=Array.isArray(r.questions)?r.questions:[],e.duration=r.duration_seconds||60,e.sessionId=r.session_id,e.answers={},e.startCountdown(e.duration)}catch(s){alert("Unable to fetch questions: "+String(s?.error?.error||s))}})()}startCountdown(e){this.clearTimer(),this.countdown=e,this.timerRef=setInterval(()=>{this.countdown-=1,this.countdown<=0&&this.clearTimer()},1e3)}clearTimer(){this.timerRef&&(clearInterval(this.timerRef),this.timerRef=null)}submitAnswers(){var e=this;return(0,d.A)(function*(){if(!e.sessionId)return alert("No active session");try{const s=e.auth.getToken(),i=s?new h.Lr({Authorization:"Bearer "+s}):void 0,r={session_id:e.sessionId,answers:e.answers},u=yield e.http.post(e.API+"/daily/submit",r,{headers:i}).toPromise();alert("Submitted OK in "+Math.round(u.elapsed_seconds||0)+"s"),e.clearTimer(),e.questions=null,e.sessionId=void 0}catch(s){alert("Submit failed: "+String(s?.error?.error||s))}})()}static \u0275fac=function(s){return new(s||o)(t.rXU(D.Ix),t.rXU(h.Qq),t.rXU(T.u))};static \u0275cmp=t.VBU({type:o,selectors:[["app-daily-contest"]],decls:11,vars:8,consts:[[1,"system-page"],[1,"system-header"],[1,"back-btn",3,"click"],[1,"system-body"],[4,"ngIf"],["rows","6","cols","60",3,"ngModelChange","ngModel"],[2,"margin-top","8px"],[3,"click"],[3,"ngSubmit"],["style","margin-bottom:12px",4,"ngFor","ngForOf"],["type","button",3,"click","disabled"],[2,"margin-bottom","12px"],["rows","3","cols","60",3,"ngModelChange","ngModel","name"]],template:function(s,i){1&s&&(t.j41(0,"div",0)(1,"header",1)(2,"button",2),t.bIt("click",function(){return i.onBack()}),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"h2"),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"section",3),t.DNE(9,E,15,2,"div",4)(10,B,6,3,"div",4),t.k0s()()),2&s&&(t.R7$(3),t.SpI("\u2190 ",t.bMT(4,4,"BACK")),t.R7$(3),t.JRh(t.bMT(7,6,"DAILY_CONTEST")),t.R7$(3),t.Y8G("ngIf",i.isSupervisor),t.R7$(),t.Y8G("ngIf",!i.isSupervisor))},dependencies:[v.MD,v.Sq,v.bT,m.h,l.YN,l.qT,l.me,l.BC,l.cb,l.vS,l.cV,m.D9],styles:[".system-page[_ngcontent-%COMP%]{padding:16px}.system-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.back-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;font-size:16px}.system-body[_ngcontent-%COMP%]{margin-top:16px}"]})}return o})()}}]);